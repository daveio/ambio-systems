# Ambio Systems Agent Documentation

This document provides essential context for AI agents working in the Ambio Systems codebase.

## Project Overview

**Ambio Systems** is a Nuxt 4 application deployed to Cloudflare Workers/Pages. It uses Drizzle ORM with Cloudflare D1 (SQLite) and Cloudflare KV.

- **Framework**: Nuxt 4 (Vue 3)
- **Runtime**: Bun (Package Manager & Runtime)
- **Database**: Cloudflare D1 (SQLite)
- **ORM**: Drizzle ORM
- **Styling**: Tailwind CSS v4 + DaisyUI v5
- **Deployment**: Cloudflare Workers (Nitro `cloudflare_module` preset)
- **Linting**: Trunk (Prettier, ESLint, etc.)

## Essential Commands

Always use `bun` for scripts.

### Development

- `bun run dev` - Start development server (runs build + wrangler dev).
- `bun run build` - Build the application for production.
- `bun run format` - Format code using Prettier and Trunk.
- `bun run cf-typegen` - Generate Cloudflare Worker types.

### Database (Drizzle + D1)

- `bun run db:generate` - Generate SQL migrations from schema changes.
- `bun run db:migrate:local` - Apply migrations to local D1 database.
- `bun run db:migrate:remote` - Apply migrations to production D1 database.
- `bun run db:studio` - Open Drizzle Studio to inspect local database.

### Deployment

- `bun run deploy` - Build and deploy to Cloudflare.

## Code Structure

- **`app/`**: Nuxt application source code.
  - **`components/`**: Vue components.
  - **`composables/`**: Vue composables (e.g., `useTheme.ts`).
  - **`assets/`**: Static assets and global CSS (`tailwind.css`).
  - **`plugins/`**: Nuxt plugins.
- **`server/`**: Server-side logic (Nitro).
  - **`api/`**: API event handlers (e.g., `subscribe.post.ts`).
  - **`database/`**: Database configuration and schema (`schema.ts`).
  - **`utils/`**: Shared server utilities.
- **`drizzle/`**: SQL migration files (generated by Drizzle Kit).
- **`public/`**: Static files served at root (images, favicon, etc.).
- **`.trunk/`**: Configuration for Trunk (meta-linter).

## Configuration Files

- **`nuxt.config.ts`**: Main Nuxt configuration (modules, CSS, Vite config).
- **`wrangler.jsonc`**: Cloudflare configuration (D1, KV, variables).
- **`drizzle.config.ts`**: Drizzle Kit configuration.
- **`package.json`**: Dependencies and scripts.
- **`mise.toml`**: Tool version management (currently active).

## Patterns & Conventions

### Database

- Define schemas in `server/database/schema.ts`.
- Always run `bun run db:generate` after modifying the schema.
- Use `db:migrate:local` to test changes locally.

### Styling

- Uses **Tailwind CSS v4**. Configuration is primarily in CSS (`app/assets/css/tailwind.css`) rather than a JS config file.
- Uses **DaisyUI v5** for component primitives.
- Dark mode is handled via `useTheme` composable and `data-theme` attribute.

### API Routes

- Located in `server/api/`.
- Use standard Nitro event handlers (`defineEventHandler`).
- Validate inputs using Zod (if available) or manual checks.

## Gotchas

- **Bun**: This project uses Bun exclusively. Do not use `npm` or `yarn`.
- **Cloudflare Bindings**: Local development relies on `wrangler` to mock D1 and KV bindings. Ensure `wrangler.jsonc` is up to date.
- **Nuxt 4**: This is a Nuxt 4 project (beta/early access patterns may apply).
